# Preventive Protocols: Anti-Pattern Prevention System

**Status**: ACTIVE
**Version**: 1.0.0
**Created**: 2025-11-17
**Purpose**: Systematic decision-tree protocols to prevent nudge-identified anti-patterns

---

## ğŸ¯ Core Principle

**STOP, AUDIT, RESEARCH, INTEGRATE** before creating, moving, or restructuring.

---

## ğŸ“‹ Protocol 1: Before Creating ANY File

### Decision Tree: "Should I Create This File?"

```
START: User requests new file or feature
  â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ STEP 1: EXISTENCE CHECK                 â”‚
  â”‚ â“ Does similar file already exist?     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“ YES                    â†“ NO
          â”‚                        â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ ğŸ›‘ STOP           â”‚      â”‚ STEP 2: SCOPE    â”‚
  â”‚ Edit existing    â”‚      â”‚ CHECK            â”‚
  â”‚ file instead     â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
                                   â†“
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ â“ Does existing       â”‚
                          â”‚ structure handle this? â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“ YES    â†“ NO
                                â”‚        â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ ğŸ›‘ STOP  â”‚  â”‚ STEP 3:     â”‚
                        â”‚ Extend   â”‚  â”‚ FRAMEWORK   â”‚
                        â”‚ existing â”‚  â”‚ RESEARCH    â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                           â†“
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚ â“ Is there a       â”‚
                                  â”‚ standard framework?â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â†“ YES  â†“ NO
                                        â”‚      â”‚
                                â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”
                                â”‚ ğŸ›‘ STOP  â”‚ â”‚ STEP 4:â”‚
                                â”‚ Use      â”‚ â”‚ AUDIT  â”‚
                                â”‚ frameworkâ”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
                                                 â†“
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚ â“ Redundancy   â”‚
                                        â”‚ audit passed?  â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â†“ NO   â†“ YES
                                             â”‚      â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                                    â”‚ ğŸ›‘ STOP   â”‚ â”‚ âœ… CREATEâ”‚
                                    â”‚ Integrate â”‚ â”‚ NEW FILEâ”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Checklist: File Creation Protocol

#### â˜‘ï¸ Phase 1: Existence Audit (MANDATORY)

```bash
# 1. Search for similar files by name pattern
glob "**/*<keyword>*"

# 2. Search for similar files by content/purpose
grep -r "<functionality>" --type md,js,ts,json

# 3. Check session artifacts from previous sessions
ls sessions/*/artifacts/{docs,code,tests,scripts}/ | grep "<topic>"

# 4. Search project memory for prior decisions
# Use: mcp__claude-flow_alpha__memory_search({ pattern: "<topic>", limit: 20 })
```

**Decision Point**:
- âœ… **None found** â†’ Proceed to Phase 2
- ğŸ›‘ **Similar found** â†’ STOP. Edit existing file instead. Ask: "I found `<file>` which seems to cover this. Should I enhance it instead?"

---

#### â˜‘ï¸ Phase 2: Structural Scope Check (MANDATORY)

```bash
# 1. Read relevant documentation structure
read WORKSPACE-GUIDE.md
read WORKSPACE-ARCHITECTURE.md
read docs/README.md

# 2. Check existing directory organization
ls -la docs/
ls -la docs/guides/
ls -la sessions/session-*/artifacts/

# 3. Verify file routing rules
grep -A 20 "File Routing" WORKSPACE-GUIDE.md
```

**Questions to Answer**:
1. Does existing documentation structure already have a section for this?
2. Can this be added to an existing guide vs creating new file?
3. Does the file routing system already specify where this should go?

**Decision Point**:
- âœ… **New scope** â†’ Proceed to Phase 3
- ğŸ›‘ **Existing structure handles it** â†’ STOP. Add to existing structure. Ask: "This belongs in `<existing-section>`. Should I add it there?"

---

#### â˜‘ï¸ Phase 3: Framework Research (MANDATORY)

**Research Standard Frameworks**:

```markdown
# For Documentation:
- [ ] DiÃ¡taxis Framework (tutorials, how-to, reference, explanation)
- [ ] C4 Model (architecture diagrams)
- [ ] ADR (Architecture Decision Records)
- [ ] README templates (project overview)

# For Code:
- [ ] Design Patterns (GoF, Enterprise, Domain-Driven)
- [ ] Project structure conventions (language-specific)
- [ ] Testing frameworks (Jest, Mocha, Pytest)

# For Configuration:
- [ ] Standard config formats (package.json, tsconfig.json)
- [ ] Industry conventions (eslint, prettier, git)
```

**Decision Point**:
- âœ… **No standard exists** â†’ Proceed to Phase 4
- ğŸ›‘ **Standard framework exists** â†’ STOP. Use framework. Ask: "Should I use `<framework>` instead of creating custom structure?"

---

#### â˜‘ï¸ Phase 4: Redundancy Audit (MANDATORY)

**Cross-Reference Check**:

```bash
# 1. List all documentation files
find docs/ sessions/ -name "*.md" -type f

# 2. Map topics to files (create mental/actual map)
# Topic: Session Management
#   - WORKSPACE-GUIDE.md (section)
#   - CLAUDE.md (section)
#   - sessions/*/artifacts/docs/session-*.md

# 3. Identify overlaps
grep -r "<topic>" docs/ sessions/*/artifacts/docs/

# 4. Check for competing sources of truth
# Are there multiple files claiming to be "the guide" for this?
```

**Red Flags** (STOP if found):
- âŒ Multiple files with same purpose
- âŒ Topic already covered in 2+ places
- âŒ Competing "authoritative" guides
- âŒ Similar file names (guide.md vs GUIDE.md vs guide-v2.md)

**Decision Point**:
- âœ… **No redundancy** â†’ Proceed to Phase 5
- ğŸ›‘ **Redundancy detected** â†’ STOP. Consolidate first. Ask: "I found redundancy between `<file1>` and `<file2>`. Should I consolidate before adding new content?"

---

#### â˜‘ï¸ Phase 5: Integration Planning (MANDATORY)

**Plan Integration Before Creation**:

1. **Cross-Links**: How will this integrate with existing docs?
2. **Navigation**: Where in the navigation hierarchy?
3. **References**: Which files will reference this?
4. **Discovery**: How will users find this?
5. **Maintenance**: Who owns updates? What's the lifecycle?

**Template for Integration Plan**:

```markdown
## Integration Plan: <new-file-name>

### Purpose
[One sentence: what problem does this solve?]

### Scope Justification
[Why can't existing files handle this?]

### Cross-Links
- Referenced by: [list files that will link here]
- References to: [list files this will link to]

### Navigation Placement
- Parent: [where in hierarchy?]
- Siblings: [what else at this level?]

### Discovery Path
- Primary: [how do users find this?]
- Secondary: [alternative discovery methods?]

### Maintenance
- Owner: [who updates this?]
- Trigger: [when does this need updates?]
- Lifecycle: [how long is this relevant?]
```

**Decision Point**:
- âœ… **Integration plan complete** â†’ CREATE FILE
- ğŸ›‘ **Integration unclear** â†’ STOP. Ask: "I'm unclear on how this integrates with `<existing-structure>`. Can you clarify the relationship?"

---

## ğŸ“‹ Protocol 2: Before Moving ANY File

### Decision Tree: "Should I Move This File?"

```
START: Impulse to move file
  â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ STEP 1: ROOT CAUSE ANALYSIS      â”‚
  â”‚ â“ Am I fixing symptom or cause? â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“ SYMPTOM              â†“ CAUSE
          â”‚                      â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ ğŸ›‘ STOP         â”‚      â”‚ STEP 2:       â”‚
  â”‚ Fix root cause â”‚      â”‚ REFERENCE     â”‚
  â”‚ instead        â”‚      â”‚ AUDIT         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â†“
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ â“ Should I fix     â”‚
                        â”‚ references instead?â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“ YES   â†“ NO
                              â”‚       â”‚
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                      â”‚ ğŸ›‘ STOP   â”‚ â”‚ STEP 3: â”‚
                      â”‚ Update    â”‚ â”‚ ROUTING â”‚
                      â”‚ referencesâ”‚ â”‚ CHECK   â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â†“
                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                               â”‚ â“ File routing â”‚
                               â”‚ rules verified?â”‚
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“ NO   â†“ YES
                                    â”‚      â”‚
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”
                            â”‚ ğŸ›‘ STOP   â”‚ â”‚ STEP 4:â”‚
                            â”‚ Follow    â”‚ â”‚ IMPACT â”‚
                            â”‚ routing   â”‚ â”‚ ANALYSISâ”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â†“
                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                     â”‚ â“ Impact       â”‚
                                     â”‚ acceptable?    â”‚
                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â†“ NO  â†“ YES
                                          â”‚     â”‚
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â” â”Œâ”€â–¼â”€â”€â”€â”€â”
                                  â”‚ ğŸ›‘ STOP  â”‚ â”‚âœ… MOVEâ”‚
                                  â”‚ Too riskyâ”‚ â””â”€â”€â”€â”€â”€â”€â”˜
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Checklist: File Movement Protocol

#### â˜‘ï¸ Phase 1: Root Cause Analysis (MANDATORY)

**Why Am I Moving This File?**

Common **symptom-based** reasons (ğŸ›‘ STOP):
- âŒ "It's in the wrong place" â† Why was it placed there originally?
- âŒ "I can't find it" â† Is discovery the real problem?
- âŒ "It doesn't fit" â† Should structure change, not file?
- âŒ "Cleanup" â† Is this cosmetic or functional?

Common **cause-based** reasons (âœ… Proceed):
- âœ… File routing rules specify different location
- âœ… File contradicts documented structure
- âœ… File is misclassified (session artifact in root)
- âœ… File has no valid reason to exist in current location

**Questions to Ask**:
1. What problem am I actually solving?
2. Will moving this file solve the root cause?
3. Am I avoiding fixing the real issue?

**Decision Point**:
- âœ… **Root cause identified** â†’ Proceed to Phase 2
- ğŸ›‘ **Symptom fix** â†’ STOP. Identify root cause. Ask: "I want to move `<file>` because `<reason>`. Is this fixing symptom or cause?"

---

#### â˜‘ï¸ Phase 2: Reference Audit (MANDATORY)

**Who References This File?**

```bash
# 1. Search for file references
grep -r "<filename>" --exclude-dir=node_modules

# 2. Search for path references
grep -r "<filepath>" --exclude-dir=node_modules

# 3. Check documentation links
grep -r "\[.*\](<filepath>)" docs/ sessions/

# 4. Check imports/requires (for code files)
grep -r "import.*<filename>" src/
grep -r "require.*<filename>" src/

# 5. Check git history for move reasons
git log --follow --oneline -- <filepath>
```

**Analysis Questions**:
1. How many files reference this?
2. Are references hard-coded or dynamic?
3. Will references break or auto-update?
4. Is there a symlink/alias option instead?

**Decision Point**:
- âœ… **Few/no references OR references easily updated** â†’ Proceed to Phase 3
- ğŸ›‘ **Many references OR brittle links** â†’ STOP. Update references instead. Ask: "Moving `<file>` will break `<N>` references. Should I update references to current location instead?"

---

#### â˜‘ï¸ Phase 3: Routing Rules Verification (MANDATORY)

**Does File Routing System Specify This?**

```bash
# 1. Check file routing documentation
grep -A 50 "File Routing" WORKSPACE-GUIDE.md
grep -A 50 "File Routing" CLAUDE.md

# 2. Check session management rules
grep -A 30 "Session Management" WORKSPACE-GUIDE.md

# 3. Verify destination is documented
# Is the target location defined in routing rules?
```

**Routing Rules Reference**:

| File Type | Correct Location | Wrong Location |
|-----------|------------------|----------------|
| Session code | `sessions/$SESSION_ID/artifacts/code/` | `src/`, `lib/`, root |
| Session docs | `sessions/$SESSION_ID/artifacts/docs/` | `docs/`, root |
| Session tests | `sessions/$SESSION_ID/artifacts/tests/` | `tests/`, `__tests__/` |
| Project docs | `docs/`, `docs/guides/` | `sessions/`, root |
| Project code | `src/`, `lib/` | `sessions/`, root |
| Configs | Root (e.g., `package.json`) | `sessions/`, `docs/` |

**Decision Point**:
- âœ… **Routing rules verified, move is compliant** â†’ Proceed to Phase 4
- ğŸ›‘ **Routing rules don't specify this OR move violates rules** â†’ STOP. Ask: "File routing rules don't clearly specify this. Should we document the rule first?"

---

#### â˜‘ï¸ Phase 4: Impact Analysis (MANDATORY)

**What Breaks If I Move This?**

**Impact Categories**:

1. **Build/Tests**: Will build or tests fail?
   ```bash
   npm run build
   npm run test
   npm run lint
   ```

2. **Documentation**: Will documentation links break?
   ```bash
   # Check for broken internal links
   grep -r "\[.*\](<old-path>)" docs/
   ```

3. **Tooling**: Will tools (ESLint, TypeScript, etc.) break?
   ```bash
   # Check tool configs
   cat tsconfig.json | grep "<old-path>"
   cat .eslintrc | grep "<old-path>"
   ```

4. **Git History**: Will file history be lost?
   ```bash
   # Git tracks moves automatically IF done correctly
   git mv <old> <new>  # Preserves history
   # vs
   rm <old> && touch <new>  # Loses history
   ```

5. **User Discovery**: Will users be unable to find this?
   ```bash
   # Check if file is referenced in guides/READMEs
   grep -r "<filename>" docs/README.md docs/guides/README.md
   ```

**Risk Matrix**:

| Impact Level | Build | Docs | Tooling | History | Discovery | Action |
|--------------|-------|------|---------|---------|-----------|--------|
| **None** | âœ… Pass | âœ… No links | âœ… Works | âœ… Preserved | âœ… Documented | âœ… MOVE |
| **Low** | âœ… Pass | âš ï¸ 1-2 links | âœ… Works | âœ… Preserved | âš ï¸ Findable | âœ… MOVE + Update |
| **Medium** | âš ï¸ Warnings | âš ï¸ 3-5 links | âš ï¸ Needs config | âœ… Preserved | âš ï¸ Needs guide | ğŸ›‘ STOP + Plan |
| **High** | âŒ Fails | âŒ 6+ links | âŒ Breaks | âŒ Lost | âŒ Hidden | ğŸ›‘ STOP |

**Decision Point**:
- âœ… **Impact = None/Low** â†’ MOVE FILE
- ğŸ›‘ **Impact = Medium/High** â†’ STOP. Create migration plan. Ask: "Moving `<file>` has `<impact-level>` impact. Should I create a migration plan first?"

---

## ğŸ“‹ Protocol 3: Before Structural Changes

### Decision Tree: "Should I Restructure?"

```
START: Impulse to restructure
  â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ STEP 1: CURRENT STATE AUDIT     â”‚
  â”‚ â“ Do I understand current state?â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“ NO                  â†“ YES
          â”‚                     â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ ğŸ›‘ STOP         â”‚     â”‚ STEP 2:       â”‚
  â”‚ Audit first    â”‚     â”‚ FRAMEWORK MAP â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â†“
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚ â“ Maps to standard â”‚
                       â”‚ framework?         â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ YES      â†“ NO
                            â”‚          â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ ğŸ›‘ STOP    â”‚  â”‚ STEP 3:    â”‚
                    â”‚ Align with â”‚  â”‚ EXISTING   â”‚
                    â”‚ framework  â”‚  â”‚ ORG CHECK  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â†“
                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚ â“ Existing org â”‚
                                â”‚ is working?    â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“ YES  â†“ NO
                                    â”‚      â”‚
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â” â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚ ğŸ›‘ STOP   â”‚ â”‚ STEP 4:  â”‚
                            â”‚ Don't fix â”‚ â”‚ CONSOLI- â”‚
                            â”‚ not brokenâ”‚ â”‚ DATE PLANâ”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â†“
                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                     â”‚ â“ Consolidate  â”‚
                                     â”‚ vs expand?     â”‚
                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â†“ EXPAND â†“ CONSOLIDATE
                                          â”‚        â”‚
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚ ğŸ›‘ STOP   â”‚  â”‚ âœ… RESTRUCâ”‚
                                  â”‚ YAGNI     â”‚  â”‚ -TURE    â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Checklist: Structural Change Protocol

#### â˜‘ï¸ Phase 1: Current State Audit (MANDATORY)

**Complete System Inventory**:

```bash
# 1. List ALL relevant files
find docs/ sessions/ -type f -name "*.md" | sort

# 2. Map directory structure
tree docs/
tree sessions/

# 3. Document current organization
# Create: current-state-map.md
```

**Current State Map Template**:

```markdown
## Current State Audit: <subsystem>

### File Inventory
[List ALL files with purpose]

| File Path | Purpose | Last Modified | Size | Owner |
|-----------|---------|---------------|------|-------|
| ... | ... | ... | ... | ... |

### Directory Structure
[Tree view of current organization]

### Organization Patterns
[What patterns exist? What's the current logic?]

### Pain Points
[What's broken? What's confusing?]

### Working Well
[What should be preserved?]

### Dependencies
[What depends on this structure?]
```

**Decision Point**:
- âœ… **Current state fully documented** â†’ Proceed to Phase 2
- ğŸ›‘ **Gaps in understanding** â†’ STOP. Complete audit. Ask: "I don't fully understand the current structure. Should I audit before restructuring?"

---

#### â˜‘ï¸ Phase 2: Framework Mapping (MANDATORY)

**Map to Established Frameworks**:

**For Documentation Structure**:

| Framework | Use Case | Structure |
|-----------|----------|-----------|
| **DiÃ¡taxis** | Technical docs | Tutorials, How-To, Reference, Explanation |
| **C4 Model** | Architecture | Context, Container, Component, Code |
| **DocOps** | Documentation ops | Plan, Create, Review, Publish, Maintain |
| **Information Architecture** | Content org | Hierarchical, Sequential, Matrix, Network |

**For Code Structure**:

| Framework | Use Case | Structure |
|-----------|----------|-----------|
| **MVC** | UI patterns | Models, Views, Controllers |
| **Clean Architecture** | Domain separation | Entities, Use Cases, Interface Adapters, Frameworks |
| **Microservices** | Distributed systems | Service per domain |
| **Monorepo** | Multi-project | Packages, shared libs |

**Framework Analysis Template**:

```markdown
## Framework Mapping: <framework>

### Framework Overview
[Brief description]

### Alignment Analysis
- âœ… **Fits**: [what fits this framework?]
- âš ï¸ **Partial fit**: [what partially fits?]
- âŒ **Doesn't fit**: [what doesn't fit?]

### Gaps
[What would we need to change to fully align?]

### Benefits
[What do we gain from alignment?]

### Costs
[What's the migration cost?]

### Recommendation
[Should we align with this framework?]
```

**Decision Point**:
- âœ… **No standard framework fits** â†’ Proceed to Phase 3
- ğŸ›‘ **Standard framework available** â†’ STOP. Align with framework. Ask: "Should we align with `<framework>` instead of custom structure?"

---

#### â˜‘ï¸ Phase 3: Existing Organization Check (MANDATORY)

**Is Current Organization Working?**

**Health Indicators**:

| Indicator | Healthy âœ… | Unhealthy âŒ |
|-----------|-----------|-------------|
| **Findability** | Users can locate files in <30s | Users can't find files |
| **Consistency** | Clear patterns exist | Ad-hoc organization |
| **Scalability** | Grows without confusion | Breaks down with growth |
| **Maintainability** | Easy to update | Hard to keep current |
| **Comprehensibility** | New users understand quickly | Requires deep knowledge |

**Assessment Questions**:

1. **Can new users navigate the structure?**
   - âœ… Yes â†’ Structure is clear
   - âŒ No â†’ Structure is confusing

2. **Are there clear organizing principles?**
   - âœ… Yes â†’ Structure is intentional
   - âŒ No â†’ Structure is accidental

3. **Is the structure documented?**
   - âœ… Yes â†’ Structure is maintained
   - âŒ No â†’ Structure is undocumented

4. **Does the structure scale?**
   - âœ… Yes â†’ Structure is robust
   - âŒ No â†’ Structure is fragile

5. **Is the structure being followed?**
   - âœ… Yes â†’ Structure is working
   - âŒ No â†’ Structure is ignored

**Decision Point**:
- âœ… **Structure is failing (3+ âŒ)** â†’ Proceed to Phase 4
- ğŸ›‘ **Structure is working (3+ âœ…)** â†’ STOP. Don't fix what's not broken. Ask: "Current structure seems to be working. Why restructure?"

---

#### â˜‘ï¸ Phase 4: Consolidation Planning (MANDATORY)

**Consolidate vs Expand?**

**Consolidation Indicators** (âœ… Restructure):
- âŒ Duplicate files/content
- âŒ Overlapping scopes
- âŒ Multiple "sources of truth"
- âŒ Fragmented information
- âŒ Too many small files

**Expansion Indicators** (ğŸ›‘ STOP - YAGNI):
- âš ï¸ "We might need this someday"
- âš ï¸ "Let's organize for future growth"
- âš ï¸ "This will be cleaner"
- âš ï¸ Adding structure without content
- âš ï¸ Premature optimization

**Consolidation Plan Template**:

```markdown
## Consolidation Plan: <subsystem>

### Problem Statement
[What problem are we solving? Be specific.]

### Current State
[Reference audit from Phase 1]

### Target State
[What's the desired end state?]

### Consolidation Strategy
- **Merge**: [files A + B â†’ C]
- **Archive**: [obsolete files â†’ archive]
- **Redirect**: [old paths â†’ new paths]
- **Delete**: [truly redundant â†’ delete]

### Migration Steps
1. [Step-by-step plan]
2. [...]

### Backward Compatibility
[How do we handle existing references?]

### Validation
[How do we verify consolidation succeeded?]

### Rollback Plan
[What if this breaks things?]
```

**Decision Point**:
- âœ… **Consolidation plan complete, validated** â†’ RESTRUCTURE
- ğŸ›‘ **Expansion-focused OR plan incomplete** â†’ STOP. Ask: "This seems like expansion, not consolidation. Should we apply YAGNI?"

---

## ğŸ¯ Adoption Plan

### Phase 1: Protocol Integration (Week 1)

**Embed in CLAUDE.md**:

```markdown
## Before Creating Files - MANDATORY PROTOCOL

Before creating ANY file, you MUST:
1. âœ… Run existence check: `glob "**/*<keyword>*"`
2. âœ… Check structure: Can existing files handle this?
3. âœ… Research frameworks: Is there a standard?
4. âœ… Audit redundancy: Will this duplicate content?
5. âœ… Plan integration: How does this fit?

See: sessions/session-20251117-100232-docs-refactor-tutor/artifacts/notes/preventive-protocols.md
```

---

### Phase 2: Tooling Support (Week 2)

**Create Validation Scripts**:

```bash
# .claude/scripts/validate-file-creation.sh
#!/bin/bash
# Validates file creation against protocols

FILENAME="$1"
PROTOCOL="file-creation"

echo "ğŸ” Running Protocol: $PROTOCOL"
echo "ğŸ“„ File: $FILENAME"

# Phase 1: Existence check
echo "âœ… Phase 1: Existence Check"
glob "**/*$(basename $FILENAME)*"

# Phase 2: Structure check
echo "âœ… Phase 2: Structure Check"
# ... automation ...

# Phase 3: Framework check
echo "âœ… Phase 3: Framework Research"
# ... automation ...

# Phase 4: Redundancy audit
echo "âœ… Phase 4: Redundancy Audit"
# ... automation ...

echo "âœ… All phases passed. File creation approved."
```

---

### Phase 3: Habit Formation (Ongoing)

**Nudge System Integration**:

1. **Pre-commit hook**: Validate file creation/moves against protocols
2. **Session closeout**: Review protocol adherence
3. **Memory triggers**: Store protocol violations for learning

**Example Pre-commit Hook**:

```bash
#!/bin/bash
# .git/hooks/pre-commit

# Check for new files
NEW_FILES=$(git diff --cached --name-only --diff-filter=A)

for file in $NEW_FILES; do
  echo "ğŸ” Validating new file: $file"
  .claude/scripts/validate-file-creation.sh "$file" || exit 1
done

echo "âœ… All new files validated"
```

---

### Phase 4: Continuous Improvement (Monthly)

**Protocol Review Cycle**:

1. **Collect violations**: Track protocol bypasses
2. **Analyze patterns**: Why were protocols skipped?
3. **Refine protocols**: Update based on learnings
4. **Document exceptions**: When is it OK to skip?

**Review Template**:

```markdown
## Protocol Review: YYYY-MM

### Violations
| Protocol | Bypassed | Reason | Justified? |
|----------|----------|--------|------------|
| ... | ... | ... | ... |

### Pattern Analysis
[What patterns emerged?]

### Protocol Refinements
[What should change?]

### Exceptions Documented
[When is it OK to skip protocols?]
```

---

## ğŸ“Š Success Metrics

**Protocol Adoption**:
- âœ… **100% adherence** in new sessions within 1 month
- âœ… **Zero nudges** for covered scenarios within 2 months
- âœ… **Automated validation** in pre-commit hooks within 1 month

**Quality Improvement**:
- âœ… **50% reduction** in duplicate files within 1 month
- âœ… **Zero structural refactors** without cause within 2 months
- âœ… **100% framework alignment** for new structures within 3 months

**Efficiency Gains**:
- âœ… **Faster decisions**: Protocols reduce decision paralysis
- âœ… **Fewer mistakes**: Automated validation catches errors
- âœ… **Better onboarding**: New agents follow protocols systematically

---

## ğŸ“ Training & Onboarding

### New Agent Onboarding

**Protocol Orientation** (First Session):

```markdown
## Welcome! Before You Create, Move, or Restructure...

You MUST follow these protocols:

1. **Creating files?** â†’ Read Protocol 1 (File Creation)
2. **Moving files?** â†’ Read Protocol 2 (File Movement)
3. **Restructuring?** â†’ Read Protocol 3 (Structural Changes)

**Location**: sessions/session-20251117-100232-docs-refactor-tutor/artifacts/notes/preventive-protocols.md

**Quick Reference**:
- STOP, AUDIT, RESEARCH, INTEGRATE
- Check existing before creating new
- Fix root cause, not symptoms
- Integrate, don't duplicate
- Research frameworks before implementing
```

---

### Protocol Quick Reference Card

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  ğŸš¨ PREVENTIVE PROTOCOLS - QUICK REFERENCE       â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  BEFORE CREATING FILES:                            â•‘
â•‘  1. âœ… Existence check (glob, grep)               â•‘
â•‘  2. âœ… Structure check (can existing handle?)     â•‘
â•‘  3. âœ… Framework research (standard exists?)      â•‘
â•‘  4. âœ… Redundancy audit (duplicates?)             â•‘
â•‘  5. âœ… Integration plan (cross-links, nav)        â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  BEFORE MOVING FILES:                              â•‘
â•‘  1. âœ… Root cause (symptom vs cause?)             â•‘
â•‘  2. âœ… Reference audit (what breaks?)             â•‘
â•‘  3. âœ… Routing rules (compliant?)                 â•‘
â•‘  4. âœ… Impact analysis (acceptable risk?)         â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  BEFORE RESTRUCTURING:                             â•‘
â•‘  1. âœ… Current state audit (understand?)          â•‘
â•‘  2. âœ… Framework mapping (standard exists?)       â•‘
â•‘  3. âœ… Organization check (working?)              â•‘
â•‘  4. âœ… Consolidate vs expand (YAGNI?)             â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  ğŸ¯ GOLDEN RULE:                                   â•‘
â•‘  STOP, AUDIT, RESEARCH, INTEGRATE                  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ“– Appendix: Real-World Examples

### Example 1: File Creation - Documentation Guide

**Scenario**: Agent wants to create `docs/session-management-guide.md`

**Protocol Application**:

```bash
# Phase 1: Existence check
$ glob "**/*session*management*"
Found:
  - WORKSPACE-GUIDE.md (has section: "Session Management Protocol")
  - CLAUDE.md (has section: "SESSION MANAGEMENT PROTOCOL")
  - sessions/session-*/artifacts/docs/session-*.md (several)

# ğŸ›‘ STOP: Similar content exists

# Decision: Add to existing WORKSPACE-GUIDE.md instead of creating new file
```

**Outcome**: âœ… Prevented duplication, enhanced existing documentation

---

### Example 2: File Movement - Test Files

**Scenario**: Agent wants to move `tests/integration.test.js` to `src/__tests__/integration.test.js`

**Protocol Application**:

```bash
# Phase 1: Root cause analysis
Why? "It's in the wrong place"
Root cause: File routing rules specify session tests go to sessions/$SESSION_ID/artifacts/tests/

# ğŸ›‘ STOP: This is a symptom, not root cause fix

# Phase 2: Reference audit
$ grep -r "integration.test.js"
Found: package.json, jest.config.js, CI workflow

# Decision: This is project-level test, NOT session test.
# File is correctly placed in tests/.
# No move needed.
```

**Outcome**: âœ… Prevented unnecessary disruption, clarified file placement rules

---

### Example 3: Structural Change - Documentation Reorganization

**Scenario**: Agent wants to reorganize `docs/` into subdirectories

**Protocol Application**:

```bash
# Phase 1: Current state audit
$ tree docs/
docs/
  â”œâ”€â”€ WORKSPACE-GUIDE.md
  â”œâ”€â”€ WORKSPACE-ARCHITECTURE.md
  â”œâ”€â”€ guides/
  â”‚   â”œâ”€â”€ integration-testing-guide.md
  â”‚   â”œâ”€â”€ feature-verification-checklist.md
  â”‚   â””â”€â”€ troubleshooting-guide.md
  â””â”€â”€ README.md

# Phase 2: Framework mapping
Framework: DiÃ¡taxis
  - Tutorials: âŒ None
  - How-To: âœ… guides/
  - Reference: âœ… WORKSPACE-ARCHITECTURE.md
  - Explanation: âœ… WORKSPACE-GUIDE.md

# Phase 3: Organization check
Findability: âœ… Clear
Consistency: âœ… Follows pattern
Scalability: âœ… guides/ subdirectory
Maintainability: âœ… Documented
Comprehensibility: âœ… README.md guides

# ğŸ›‘ STOP: Structure is working, don't fix

# Decision: No restructuring needed. Structure aligns with DiÃ¡taxis and works well.
```

**Outcome**: âœ… Preserved working structure, avoided unnecessary churn

---

## ğŸ”„ Protocol Versioning & Updates

**Version History**:
- **v1.0.0** (2025-11-17): Initial protocol creation
- **v1.1.0** (TBD): Add automation tooling
- **v1.2.0** (TBD): Refine based on first month learnings

**Update Process**:
1. Collect feedback from protocol users
2. Analyze violation patterns
3. Propose protocol refinements
4. Review & approve changes
5. Update documentation
6. Train on new protocols

---

## âœ… Summary

**Core Protocols Created**:
1. âœ… **File Creation Protocol**: 5-phase decision tree with mandatory checklists
2. âœ… **File Movement Protocol**: 4-phase decision tree with impact analysis
3. âœ… **Structural Change Protocol**: 4-phase decision tree with consolidation planning

**Key Principles**:
- ğŸ›‘ **STOP before acting**: Audit, research, plan
- ğŸ” **Check existing**: Before creating new
- ğŸ¯ **Fix root cause**: Not symptoms
- ğŸ”— **Integrate**: Don't duplicate
- ğŸ“š **Research frameworks**: Before implementing custom

**Adoption Strategy**:
- **Week 1**: Embed in CLAUDE.md
- **Week 2**: Create validation tooling
- **Ongoing**: Habit formation via hooks
- **Monthly**: Protocol review & refinement

**Success Metrics**:
- 100% protocol adherence within 1 month
- Zero nudges for covered scenarios within 2 months
- 50% reduction in duplicate files within 1 month

---

**Next Steps**:
1. Review & approve protocols
2. Integrate into CLAUDE.md
3. Create validation scripts
4. Set up pre-commit hooks
5. Begin tracking metrics

**Status**: âœ… READY FOR REVIEW
